var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,i=(t,a,s)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s,l=(e,t)=>{for(var a in t||(t={}))n.call(t,a)&&i(e,a,t[a]);if(s)for(var a of s(t))r.call(t,a)&&i(e,a,t[a]);return e},o=(e,s)=>t(e,a(s));import{u as c,a as u,n as m,c as d,C as p,R as f,b as _,f as y,d as b,e as g,g as E,P as S}from"./vendor.ad677777.js";const O=u,h=d({name:"bases",initialState:(()=>{const e=R("OT-580b");return{list:[e,R("QQ-645b")],currentId:e.id}})(),reducers:{add(e,t){e.list.push(R(t.payload))},remove(e,t){if(e.list.length<2)return;const a=e.list.findIndex((e=>e.id==t.payload));if(-1!==a){const t=e.list[a].id==e.currentId;e.list.splice(a,1),t&&(e.currentId=e.list[0].id)}},select(e,t){e.currentId=t.payload},addBuilding(e,t){const a=e.list.filter((t=>t.id==e.currentId))[0],s=a.buildings[t.payload];s?s.amount++:a.buildings[t.payload]={building:t.payload,amount:1,recipes:[]}},removeBuilding(e,t){const a=e.list.filter((t=>t.id==e.currentId))[0].buildings[t.payload];if(!a)throw new Error("Can't remove non-existing building");a.amount>0&&a.amount--},addRecipe(e,t){if(!e.list.filter((t=>t.id==e.currentId))[0].buildings[t.payload[0]])throw new Error("Can't add recipe to non-existing building")}}}),{add:C,remove:w,select:v,addBuilding:x,removeBuilding:I}=h.actions;var P=h.reducer;function R(e){return{id:m(),planet:e,buildings:{}}}function T(){return O((e=>e.bases.list.filter((t=>t.id==e.bases.currentId))[0]))}var j="_selection_1o5y6_1",k="_selected_1o5y6_9";function N(e,t=2){return e.toFixed(t)}function A({names:e,ids:t,selectedId:a,onSelect:s}){return f.createElement("div",{style:{display:"flex",flexDirection:"row"}},e.map(((e,n)=>{const r=t?t[n]:e,i=[j];return a==r&&i.push(k),f.createElement("div",{key:r,className:i.join(" "),onClick:()=>s(r)},e)})))}function M(){const e=c(),t=T(),a=t.planet,s=O((e=>e.bases.list)),[n,r]=p.exports.useState(a),i=s.filter((e=>e.planet==n)),l=function(e){const t=[],a=new Set;for(let s of e)a.has(s)||(a.add(s),t.push(s));return t}(s.map((e=>e.planet)));return f.createElement("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",width:"100%",fontSize:"14px"}},f.createElement("div",null,f.createElement(A,{names:i.map(((e,t)=>t.toString()+(e.name?" - "+e.name:""))),ids:i.map((e=>e.id)),selectedId:t.id,onSelect:t=>e(v(t))}),f.createElement(A,{names:l,selectedId:n,onSelect:e=>r(e)})),f.createElement("div",{style:{marginLeft:"30px"}}," ",f.createElement("button",{onClick:()=>e(C("OT-580b"))},"+")))}const D={materials:{},materialCategories:[],buildings:{},buildingsProduction:{},buildingCategories:{},planets:{},systems:{},planetMaxResources:{}};var F,B;let L;(B=F||(F={})).CORE="CORE",B.STORAGE="STORAGE",B.HABITATION="HABITATION",B.RESOURCES="RESOURCES",B.PRODUCTION="PRODUCTION",B.PLANETARY_PROJECT="PLANETARY_PROJECT",B.CORPORATION_PROJECT="CORPORATION_PROJECT";async function U(e){return new Promise((t=>{const a=L.transaction(e).objectStore(e).getAll();a.onsuccess=()=>{const e=a.result,s={};for(const t of e)s[t.id]=t;t(s)}}))}async function G(e,t){await new Promise((a=>{const s=L.transaction(e,"readwrite");s.oncomplete=()=>{a()};const n=s.objectStore(e);for(const e of t)n.put(e)}))}async function z(e,t){await H(e,t,"idMaps")}async function H(e,t,a,s=L){await new Promise((n=>{const r=s.transaction(a,"readwrite");r.oncomplete=()=>{n()};r.objectStore(a).put(t,e)}))}let q;async function J(e){const t="https://rest.fnar.net"+e;let a=await async function(e,t,a=L){return await new Promise((s=>{const n=a.transaction(t,"readwrite"),r=n.objectStore(t).get(e);n.oncomplete=()=>{s(r.result)}}))}(t,"fetches",q);if(a)return a.data;const s=await async function(e){console.log("fetching data",e);const t=await fetch(e,{headers:{"Content-Type":"application/json",Accept:"application/json"}});return await t.json()}(t);return await H(void 0,{url:t,timestamp:new Date,data:s},"fetches",q),s}var V={container:"_container_1u4f8_1",labelContainer:"_labelContainer_1u4f8_15",label:"_label_1u4f8_15",selected:"_selected_1u4f8_51",indicatorContainer:"_indicatorContainer_1u4f8_67",indicator:"_indicator_1u4f8_67",agricultural_products:"_agricultural_products_1u4f8_121",alloys:"_alloys_1u4f8_129",chemicals:"_chemicals_1u4f8_137",construction_materials:"_construction_materials_1u4f8_145",construction_parts:"_construction_parts_1u4f8_153",construction_prefabs:"_construction_prefabs_1u4f8_161",consumables_basic:"_consumables_basic_1u4f8_169",consumables_luxury:"_consumables_luxury_1u4f8_177",drones:"_drones_1u4f8_185",electronic_devices:"_electronic_devices_1u4f8_193",electronic_parts:"_electronic_parts_1u4f8_201",electronic_pieces:"_electronic_pieces_1u4f8_209",electronic_systems:"_electronic_systems_1u4f8_217",elements:"_elements_1u4f8_225",energy_systems:"_energy_systems_1u4f8_233",fuels:"_fuels_1u4f8_241",gases:"_gases_1u4f8_249",liquids:"_liquids_1u4f8_257",medical_equipment:"_medical_equipment_1u4f8_265",metals:"_metals_1u4f8_273",minerals:"_minerals_1u4f8_281",ores:"_ores_1u4f8_289",plastics:"_plastics_1u4f8_297",ship_engines:"_ship_engines_1u4f8_305",ship_kits:"_ship_kits_1u4f8_313",ship_parts:"_ship_parts_1u4f8_321",ship_shields:"_ship_shields_1u4f8_329",software_components:"_software_components_1u4f8_337",software_systems:"_software_systems_1u4f8_345",software_tools:"_software_tools_1u4f8_353",textiles:"_textiles_1u4f8_361",unit_prefabs:"_unit_prefabs_1u4f8_369",utility:"_utility_1u4f8_377",building:"_building_1u4f8_387",defaultColor:"_defaultColor_1u4f8_397"};function Y(e){var t;const a=D.materials[e].category.replaceAll(" ","_").replaceAll(/\(|\)/g,"");return null!=(t=V[a])?t:V.defaultColor}function Q({materialId:e,amount:t,size:a=48,fontFactor:s=.33,isSelected:n=!1,onClick:r}){const i=a;return f.createElement("div",{className:V.container,style:{}},f.createElement(W,{label:e,colorClass:Y(e),size:i,fontFactor:s,isSelected:n,onClick:a=>r&&r(e,t)}),t?f.createElement("div",{className:V.indicatorContainer},f.createElement("div",{className:V.indicator},t)):null)}function W({label:e,size:t=48,fontFactor:a=.33,colorClass:s=V.defaultColor,hoverText:n,isSelected:r=!1,onClick:i,children:l}){const o=n||e,c={height:t,width:t,fontSize:t*a,cursor:i?"pointer":"default"},u=[V.container,s];return r&&u.push(V.selected),f.createElement("div",{className:u.join(" "),style:c,title:o,onClick:e=>i&&i(e)},f.createElement("div",{className:V.labelContainer},f.createElement("span",{className:V.label},e)),l)}var X="_table_cweiz_1";const Z={MINERAL:"🧱",LIQUID:"💧",GASEOUS:"☁️"},$={Jumps:"#",Planet:"Planet",Fertility:"🌾🌱","Type\nRocky or Gaseous":"🪐",Pressure:"💨",Temperature:"🌡️",Gravity:"⚛️"},K=Object.keys($).length;let ee;const te=["MCG","AEF","SEA","HSE","INS","TSH","MGC","BL"];let ae;function se(){return ae||(ae=Object.entries({AI1:"ZV-307",CI1:"UV-351",IC1:"VH-331",NC1:"OT-580"}).reduce(((e,[t,a])=>o(l({},e),{[t]:re(a)})),{})),ae}function ne(){const[e,t]=p.exports.useState(D.planets[T().planet].system),[a,s]=p.exports.useState(new Map),[n,r]=p.exports.useState([]),[i,l]=p.exports.useState([]),[o,c]=p.exports.useState(!1),[u,m]=p.exports.useState(10),[d,_]=p.exports.useState(["MCG","AEF","SEA"]),[y,b]=p.exports.useState(0);function g(e){-1==i.indexOf(e)?l([...i,e]):l(i.filter((t=>t!=e)))}function E(e){-1==d.indexOf(e)?_([...d,e]):_(d.filter((t=>t!=e)))}function S(e){return 0==e||2==e||e>=K?()=>b(e):()=>{}}function O(e){const t=e.perDay/D.planetMaxResources[e.material];return f.createElement("div",{style:{justifyContent:"flex-end",alignItems:"flex-end",display:"flex"}},N(e.perDay)+Z[e.type],f.createElement("div",{style:{width:"0.5em",height:t+"em",backgroundColor:`rgb(${255*(1-t)}, ${255*t}, 0)`}}))}p.exports.useEffect((()=>{D.systems[e]&&(console.time("Evaluate jumps"),s(re(e)),console.timeEnd("Evaluate jumps"))}),[e]),p.exports.useEffect((()=>{console.time("Evaluate planets");const e=[];for(const[t,s]of a)if(!(u&&s>u))for(const a of D.systems[t].planets){const t=D.planets[a].cmCosts;let n=!0;for(const e of Object.keys(t))if(-1!=te.indexOf(e)&&-1==d.indexOf(e)){n=!1;break}n&&e.push({planet:a,jumps:s})}console.timeEnd("Evaluate planets"),e.sort(((e,t)=>{const a=(()=>{if(0==y)return e.jumps-t.jumps;if(2==y)return D.planets[t.planet].surfaceData.fertility-D.planets[e.planet].surfaceData.fertility;if(y>=K&&y<K+i.length){let a=function(e){const t=D.planets[e].resources.filter((e=>e.material==s))[0];return t?t.perDay:0};const s=i[y-K];return a(t.planet)-a(e.planet)}{let a=function(e){return s.get(D.planets[e].system)};const s=Object.values(se())[y-(K+i.length+5)];return a(e.planet)-a(t.planet)}})();return 0==a?e.planet.localeCompare(t.planet):a})),r(e)}),[a,u,d,y]);const h=se();return f.createElement("div",null,f.createElement("div",{style:{border:"1 solid white"}},"System: ",f.createElement("input",{value:e,onChange:e=>{t(e.target.value)},list:"LIST_systems"}),"Jumps: ",f.createElement("input",{type:"number",value:u,onChange:e=>{if(!e.target.value)return void m(void 0);const t=parseInt(e.target.value,10);t>=0&&t<100&&m(t)}})),f.createElement("div",{style:{display:"flex",flexWrap:"wrap"}},function(){if(!ee){const e=[...new Set(Object.values(D.planets).map((e=>e.resources.map((e=>e.material)))).flat())].reduce(((e,t)=>{const a=D.materials[t].category;return e[a]||(e[a]=[]),e[a].push(t),e}),{});ee=Object.keys(e).sort().map((t=>({category:t,materials:e[t].sort()})))}return ee}().map((e=>e.materials.map((e=>f.createElement("div",{key:e,style:{margin:1}},f.createElement(Q,{key:e,materialId:e,size:32,isSelected:-1!=i.indexOf(e),onClick:g})))))).flat(),f.createElement("div",{style:{margin:1,position:"relative"}},f.createElement(W,{label:"Clear",size:32,colorClass:"",onClick:()=>l([])})),f.createElement("div",{style:{margin:1,position:"relative"}},f.createElement(W,{label:o?"ALL":"ANY",hoverText:"Toggle filtering any/all selected materials",size:32,colorClass:"",onClick:()=>c(!o)}))),f.createElement("div",{style:{display:"flex",flexWrap:"wrap"}},f.createElement(W,{label:"🌾",hoverText:"Fertility",size:32}),te.map((e=>f.createElement("div",{style:{margin:1}},f.createElement(Q,{key:e,materialId:e,size:32,isSelected:-1!=d.indexOf(e),onClick:E}))))),f.createElement("div",null,f.createElement("table",{className:X},f.createElement("thead",null,f.createElement("tr",null,Object.entries($).map((([e,t],a)=>f.createElement("th",{title:e,onClick:S(a)},t+(y==a?"▼":"")))),i.map(((e,t)=>f.createElement("th",{title:e,onClick:S(K+t)},e+(y==K+t?"▼":"")))),f.createElement("th",{colSpan:5}),Object.keys(h).map(((e,t)=>f.createElement("th",{onClick:S(K+i.length+5+t)},e+(y==K+i.length+5+t?"▼":"")))))),f.createElement("tbody",null,n.filter((e=>{if(0==i.length)return!0;const t=D.planets[e.planet].resources.map((e=>e.material));for(const a of i)if(-1!=t.indexOf(a)){if(!o)return!0}else if(o)return!1;return o})).map((e=>{const t=D.planets[e.planet];return f.createElement("tr",{key:e.planet},f.createElement("td",null,e.jumps),f.createElement("td",{title:D.planets[e.planet].name},e.planet),f.createElement("td",null,-1==t.surfaceData.fertility?"-":N(30*t.surfaceData.fertility)+"%"),[["MCG","AEF"],["SEA","HSE"],["INS","TSH"],["MGC","BL"]].map((e=>{const a=e.filter((e=>t.cmCosts[e]))[0];return f.createElement("td",{className:a?Y(a):""},a)})).flat(),i.map((e=>f.createElement("td",{className:Y(e)},t.resources.filter((t=>t.material==e)).map((e=>O(e))).flat()||null))),t.resources.filter((e=>-1==i.indexOf(e.material))).sort(((e,t)=>t.perDay-e.perDay)).map((e=>f.createElement(f.Fragment,null,f.createElement("td",{className:Y(e.material),style:{textAlign:"right"}},f.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},f.createElement("div",null," ",e.material),O(e)))))).concat(new Array(5).fill(f.createElement("td",null))).slice(0,5).flat(),Object.values(h).map((t=>f.createElement("td",null,t.get(D.planets[e.planet].system)))))}))))))}function re(e){console.log("calculateSystemDistances",e);const t=new Map;t.set(e,0);let a=[],s=[e];for(;s.length;)for(a=s,s=[];a.length;){const e=a.pop(),n=t.get(e)+1,r=D.systems[e];for(const a of r.connections)t.has(a)||(t.set(a,n),s.push(a))}return t}var ie,le;(le=ie||(ie={}))[le.buildings=0]="buildings",le[le.materials=1]="materials",le[le.planets=2]="planets",le[le.systems=3]="systems";function oe(e){return"LIST_"+ie[e]}const ce={0:()=>ue(D.buildings),1:()=>ue(D.materials),2:()=>Object.entries(D.planets).map((([e,t])=>[e,t.name])),3:()=>Object.entries(D.systems).map((([e,t])=>[e,t.name]))};function ue(e){return Object.keys(e).map((e=>[e,e]))}function me({id:e,list:t}){return f.createElement("datalist",{id:e},t.map((([e,t])=>f.createElement("option",{value:e,key:t},t))))}function de(){const e=Object.keys(ie).filter((e=>"number"==typeof ie[e])).map((e=>ie[e]));return f.createElement(f.Fragment,null,e.map((e=>f.createElement(me,{key:oe(e),id:oe(e),list:ce[e]()}))))}function pe(){return f.createElement(ne,null)}function fe(){const e=f.createElement(pe,null),t=f.createElement("div",{className:"foot"},f.createElement(M,null));return f.createElement("div",{className:"App"},f.createElement(de,null),f.createElement("div",{className:"body"},null,f.createElement("div",{className:"main"},e),t))}const _e=_({reducerPath:"api",baseQuery:y({baseUrl:"https://rest.fnar.net"}),endpoints:e=>({fetchPlanets:e.query({query:()=>"/planet/allplanets"}),fetchPlanet:e.query({query:e=>`/planet/${e}`,transformResponse:e=>e.Resources,keepUnusedDataFor:604800})})}),ye=b({reducer:{[_e.reducerPath]:_e.reducer,bases:P},preloadedState:g.load(),middleware:e=>e().concat(_e.middleware).concat(g.save({ignoreStates:[_e.reducerPath]}))});(async function(){await async function(){q=await new Promise(((e,t)=>{const a=indexedDB.open("fetches",1);a.onupgradeneeded=e=>{const t=a.result;e.oldVersion<1&&t.createObjectStore("fetches",{keyPath:"url"})},a.onsuccess=()=>e(a.result),a.onerror=t})),await J("/material/allmaterials"),await J("/building/allbuildings")}(),await async function(){let e=!1;if(L=await new Promise(((t,a)=>{const s=indexedDB.open("world-data",1);s.onupgradeneeded=t=>{const a=s.result;t.oldVersion<1&&(a.createObjectStore("materials",{keyPath:"id"}),a.createObjectStore("buildings",{keyPath:"id"}),a.createObjectStore("planets",{keyPath:"id"}),a.createObjectStore("systems",{keyPath:"id"}),a.createObjectStore("sectors",{keyPath:"id"}),a.createObjectStore("idMaps")),e=!0},s.onsuccess=()=>t(s.result),s.onerror=a})),e){console.log("initializing world data");const e=await J("/material/allmaterials"),t=e.reduce(((e,t)=>o(l({},e),{[t.MatId]:t.Ticker})),{}),a=e.map((e=>({id:e.Ticker,name:e.Name,category:e.CategoryName,weight:e.Weight,volume:e.Volume})));await G("materials",a),await z("materials",t);const s=await J("/building/allbuildings"),n=e=>e.reduce(((e,t)=>o(l({},e),{[t.CommodityTicker]:t.Amount})),{}),r=s.map((e=>({id:e.Ticker,name:e.Name,type:F.PRODUCTION,workforceLevel:"Pioneers",costs:n(e.BuildingCosts),recipes:e.Recipes.map((e=>({inputs:n(e.Inputs),outputs:n(e.Outputs),durationMs:e.DurationMs}))),expertise:e.Expertise||void 0,workforce:{Pioneers:e.Pioneers,Settlers:e.Settlers,Technicians:e.Technicians,Engineers:e.Engineers,Scientists:e.Scientists},area:e.AreaCost})));for(const l of r)if("CM"==l.id)l.type=F.CORE;else if("STO"==l.id)l.type=F.STORAGE;else if(l.name.startsWith("planetaryProject"))l.type=F.PLANETARY_PROJECT;else if(l.name.startsWith("corporationProject"))l.type=F.CORPORATION_PROJECT;else if(l.recipes.length)if("RESOURCE_EXTRACTION"==l.expertise&&l.recipes.filter((e=>0==Object.keys(e.inputs).length)).length>0)l.type=F.RESOURCES;else{l.type=F.PRODUCTION;for(const e of["Scientists","Engineers","Technicians","Settlers","Pioneers"])if(l.workforce[e]>0){l.workforceLevel=e;break}}else l.type=F.HABITATION;await G("buildings",r);const i=await J("/systemstars"),c=i.reduce(((e,t)=>o(l({},e),{[t.SystemId]:t.NaturalId})),{});await z("systems",c);const u=await J("/planet/allplanets/full"),m=u.reduce(((e,t)=>o(l({},e),{[t.PlanetId]:t.PlanetNaturalId})),{}),d=u.map((e=>({id:e.PlanetNaturalId,name:e.PlanetName,system:c[e.SystemId],resources:e.Resources.map((e=>({material:t[e.MaterialId],perDay:e.Factor*("GASEOUS"==e.ResourceType?60:70),type:e.ResourceType}))),cmCosts:e.BuildRequirements.reduce(((e,t)=>o(l({},e),{[t.MaterialTicker]:t.MaterialAmount})),{}),orbitData:{gravity:e.Gravity,magneticField:e.MagneticField,mass:e.Mass,massEarth:e.MassEarth,orbitSemiMajorAxis:e.OrbitSemiMajorAxis,orbitEccentricity:e.OrbitEccentricity,orbitInclination:e.OrbitInclination,orbitRightAscension:e.OrbitRightAscension,orbitPeriapsis:e.OrbitPeriapsis,orbitIndex:e.OrbitIndex},surfaceData:{pressure:e.Pressure,radiation:e.Radiation,radius:e.Radius,sunlight:e.Sunlight,surface:e.Surface,temperature:e.Temperature,fertility:e.Fertility},factionCode:e.FactionCode||void 0,tier:0})));for(const l of d)0==l.tier&&(l.tier=1,l.cmCosts.SEA&&l.tier++,l.cmCosts.BL&&l.tier++,l.cmCosts.MGC&&l.tier++,l.cmCosts.HSE&&(l.tier+=2),l.cmCosts.INS&&(l.tier+=3),l.cmCosts.TSH&&(l.tier+=3));await G("planets",d),await z("planets",m);const p=i.map((e=>({id:e.NaturalId,name:e.Name,type:e.Type,position:[e.PositionX,e.PositionY,e.PositionZ],sector:e.SectorId,subSector:e.SubSectorId,connections:e.Connections.map((e=>c[e.Connection])),planets:d.filter((t=>t.system==e.NaturalId)).map((e=>e.id))})));await G("systems",p);const f=(await J("/systemstars/worldsectors")).map((e=>({id:e.SectorId,name:e.Name,position:[e.HexQ,e.HexR,e.HexS],subSectors:e.SubSectors.map((e=>({id:e.SSId,vertices:e.Vertices.map((e=>[e.X,e.Y,e.Z]))})))})));await G("sectors",f),console.log("finished initializing world data")}}(),[D.materials,D.buildings,D.planets,D.systems]=await Promise.all([U("materials"),U("buildings"),U("planets"),U("systems")]),D.materialCategories=[...new Set(Object.values(D.materials).map((e=>e.category)))].sort();let e=Object.keys(D.buildings);for(const a of Object.keys(F))D.buildingCategories[a]=e.filter((e=>D.buildings[e].type==a));let t=D.buildingCategories[F.PRODUCTION];for(const a of["Scientists","Engineers","Technicians","Settlers","Pioneers"])D.buildingsProduction[a]=t.filter((e=>D.buildings[e].workforce[a]>0)),t=t.filter((e=>0==D.buildings[e].workforce[a]));D.planetMaxResources={};for(const a of Object.values(D.planets))for(const{material:e,perDay:t}of a.resources)D.planetMaxResources[e]?D.planetMaxResources[e]=Math.max(D.planetMaxResources[e],t):D.planetMaxResources[e]=t})().then((()=>{E.render(f.createElement(f.StrictMode,null,f.createElement(S,{store:ye},f.createElement(fe,null))),document.getElementById("root"))}));
